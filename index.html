<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>학원 관리 시스템</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="mobile.css">
    <!-- Supabase 라이브러리 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- 다음 주소 검색 API -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <!-- QR 코드 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8"></script>
    <!-- Google Identity Services (OAuth 2.0) -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- 환경 변수 로더 (로컬 개발용) -->
    <script>
        // .env.local 파일 로드 (로컬 개발 시)
        (async () => {
            // file:// 프로토콜에서는 환경 변수 로드 건너뛰기
            if (window.location.protocol === 'file:') {
                console.warn('[env-loader] ⚠️ file:// 프로토콜 감지 - 로컬 서버를 실행하세요: python -m http.server 8000');
                window.env = {}; // 기본값 사용
                return;
            }
            
            try {
                const response = await fetch('.env.local');
                if (response.ok) {
                    const text = await response.text();
                    window.env = {};
                    text.split('\n').forEach(line => {
                        if (line && !line.startsWith('#')) {
                            const [key, ...valueParts] = line.split('=');
                            const value = valueParts.join('=').trim();
                            if (key.trim()) {
                                window.env[key.trim()] = value;
                            }
                        }
                    });
                    console.log('[env-loader] 환경 변수 로드 완료');
                }
            } catch (e) {
                console.log('[env-loader] .env.local 파일 없음 (Vercel 배포 환경)');
                window.env = {};
            }
        })();
    </script>
</head>
<body>

    <!-- 초기 로딩 중 표시 -->
    <div id="initial-loader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; display: flex; align-items: center; justify-content: center; z-index: 9999;">
        <div style="text-align: center;">
            <div style="width: 50px; height: 50px; border: 4px solid #f3f4f6; border-top: 4px solid #4f46e5; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
        </div>
    </div>
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <!-- 로그인 페이지 -->
    <div id="auth-page" class="auth-page" style="display: none; visibility: hidden;">
        <div class="auth-container">
            <div class="auth-box">
                <h1 class="auth-logo">ACADEMY MANAGER</h1>
                
                <!-- 로그인 폼 -->
                <div id="login-form" class="auth-form">
                    <h2>로그인</h2>
                    <div class="form-group">
                        <label>이메일</label>
                        <input type="email" id="login-email" class="auth-input" placeholder="example@email.com">
                    </div>
                    <div class="form-group">
                        <label>비밀번호</label>
                        <input type="password" id="login-password" class="auth-input" placeholder="비밀번호를 입력하세요">
                    </div>
                    <div class="form-group" style="display: flex; flex-direction: row; align-items: center; gap: 8px; margin-top: 8px; padding: 10px 12px; background: #f5f7ff; border-radius: 10px; align-self: flex-start;">
                        <input type="checkbox" id="remember-me" style="width: 18px; height: 18px; margin: 0; cursor: pointer; accent-color: #4f46e5;">
                        <label for="remember-me" style="margin: 0; cursor: pointer; font-weight: 600; color: #4f46e5;">로그인 유지</label>
                    </div>
                    <button class="auth-btn" onclick="signIn()">로그인</button>
                    <p class="auth-toggle">계정이 없으신가요? <a href="#" onclick="toggleAuthForm(); return false;">회원가입</a></p>
                    <p class="auth-reset">비밀번호를 변경하세요. <a href="#" class="auth-reset-link" onclick="openAdminPasswordResetModal(); return false;">비밀번호 변경</a></p>
                </div>

                <!-- 회원가입 폼 -->
                <div id="signup-form" class="auth-form" style="display: none;">
                    <h2>회원가입</h2>
                    <div class="form-group">
                        <label>이름</label>
                        <input type="text" id="signup-name" class="auth-input" placeholder="관리자 이름">
                    </div>
                    <div class="form-group">
                        <label>이메일 (구글 인증)</label>
                        <div id="admin-google-email-section">
                            <button type="button" id="admin-google-auth-btn" onclick="startGoogleAuthAdmin()" class="google-auth-btn">
                                <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                                구글 이메일 인증
                            </button>
                            <div id="admin-google-verified-email" style="display:none;">
                                <div class="google-verified-info">
                                    <span id="admin-verified-email-text" class="verified-email-text"></span>
                                    <span class="verified-badge"><i class="fas fa-check-circle"></i> 인증됨</span>
                                </div>
                                <button type="button" class="google-change-btn" onclick="startGoogleAuthAdmin()">
                                    <i class="fas fa-sync-alt"></i> 다른 계정으로 변경
                                </button>
                            </div>
                            <input type="hidden" id="signup-email">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>비밀번호</label>
                        <input type="password" id="signup-password" class="auth-input" placeholder="비밀번호를 입력하세요">
                    </div>
                    <div class="form-group">
                        <label>비밀번호 확인</label>
                        <input type="password" id="signup-password-confirm" class="auth-input" placeholder="비밀번호를 다시 입력하세요">
                    </div>
                    <button class="auth-btn" onclick="signUp()">회원가입</button>
                    <p class="auth-toggle">이미 계정이 있으신가요? <a href="#" onclick="toggleAuthForm(); return false;">로그인</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 로그인 이후 선생님 선택 페이지 -->
    <div id="teacher-select-page" class="auth-page" style="display: none;">
        <div class="auth-container">
            <button onclick="backToAdminLogin()" style="align-self: flex-start; background: none; border: none; color: rgba(255,255,255,0.85); font-size: 14px; font-weight: 600; cursor: pointer; padding: 8px 4px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='rgba(255,255,255,0.85)'"><i class="fas fa-arrow-left"></i> 관리자 로그인으로 돌아가기</button>
            <div class="auth-box">
                <h1 class="auth-logo">선생님 선택</h1>
                
                <!-- 선생님 선택 폼 -->
                <div id="teacher-select-form" class="auth-form">
                    <div class="form-group">
                        <label>등록된 선생님</label>
                        <select id="teacher-dropdown" class="auth-input" onchange="onTeacherSelected()">
                            <option value="">선생님을 선택해주세요</option>
                        </select>
                    </div>
                    
                    <!-- 모든 선생님 비밀번호 입력 -->
                    <div id="teacher-password-section" style="display: none;">
                        <div class="form-group">
                            <label>비밀번호</label>
                            <input type="password" id="teacher-select-password" class="auth-input" placeholder="비밀번호">
                        </div>
                    </div>
                    
                    <button class="auth-btn" onclick="confirmTeacher()">입장</button>
                    <button class="auth-btn" style="background-color:#b91c1c; margin-top:8px;" onclick="adminDeleteTeacher()">선생님 삭제</button>
                    <p class="auth-toggle">아직 등록된 선생님이 없으신가요? <a href="#" onclick="toggleTeacherForm(); return false;">선생님 등록</a></p>
                    <p class="auth-reset">비밀번호를 변경하세요. <a href="#" class="auth-reset-link" onclick="openTeacherPasswordResetModal(); return false;">비밀번호 변경</a></p>
                </div>

                <!-- 선생님 등록 폼 -->
                <div id="teacher-register-form" class="auth-form" style="display: none; max-height: 70vh; overflow-y: auto;">
                    <div class="form-group">
                        <label>선생님 이름</label>
                        <input type="text" id="new-teacher-name" class="auth-input" placeholder="선생님 이름">
                    </div>
                    <div class="form-group">
                        <label>이메일 (구글 인증)</label>
                        <div id="google-email-section">
                            <button type="button" id="google-auth-btn" onclick="startGoogleAuth()" class="google-auth-btn">
                                <svg width="18" height="18" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
                                구글 이메일 인증
                            </button>
                            <div id="google-verified-email" style="display:none;">
                                <div class="google-verified-info">
                                    <span id="verified-email-text" class="verified-email-text"></span>
                                    <span class="verified-badge"><i class="fas fa-check-circle"></i> 인증됨</span>
                                </div>
                                <button type="button" class="google-change-btn" onclick="startGoogleAuth()">
                                    <i class="fas fa-sync-alt"></i> 다른 계정으로 변경
                                </button>
                            </div>
                            <input type="hidden" id="new-teacher-email">
                            <input type="hidden" id="new-teacher-google-sub">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>연락처</label>
                        <input type="text" id="new-teacher-phone" class="auth-input" placeholder="010-0000-0000" maxlength="13" oninput="formatPhoneNumber(this)">
                    </div>
                    <div class="form-group">
                        <label>주소</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="new-teacher-address" class="auth-input" placeholder="주소를 검색하세요" readonly style="flex: 1; cursor: pointer;" onclick="searchAddress()">
                            <button type="button" onclick="searchAddress()" style="padding: 12px 20px; background: #6366f1; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">검색</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>상세주소 (동/호수)</label>
                        <input type="text" id="new-teacher-address-detail" class="auth-input" placeholder="예: 101동 1202호">
                    </div>
                    <div class="form-group">
                        <label>비밀번호</label>
                        <input type="password" id="register-teacher-password" class="auth-input" placeholder="비밀번호">
                    </div>
                    <div class="form-group">
                        <label>비밀번호 확인</label>
                        <input type="password" id="register-teacher-password-confirm" class="auth-input" placeholder="비밀번호 확인">
                    </div>
                    <button class="auth-btn" onclick="registerTeacher()">등록하기</button>
                    <p class="auth-toggle">이미 등록된 선생님이 있으신가요? <a href="#" onclick="toggleTeacherForm(); return false;">선생님 선택</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 관리자 비밀번호 변경 -->
    <div id="admin-password-reset-modal" class="modal auth-modal" style="display: none;">
        <div class="modal-card" style="max-width: 460px;">
            <div class="modal-header" style="border-bottom: 1px solid #e2e8f0;">
                <h2>관리자 비밀번호 변경</h2>
                <button class="btn-close-x" onclick="closeAdminPasswordResetModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable" style="padding: 20px 24px;">
                <div class="form-group">
                    <label>관리자 이메일</label>
                    <input type="email" id="admin-reset-email" class="auth-input" placeholder="example@email.com">
                </div>
                <div class="form-group">
                    <label>기존 비밀번호</label>
                    <input type="password" id="admin-current-password" class="auth-input" placeholder="현재 비밀번호를 입력하세요">
                </div>
                <div class="form-group">
                    <label>새 비밀번호</label>
                    <input type="password" id="admin-reset-new-password" class="auth-input" placeholder="새 비밀번호">
                </div>
                <div class="form-group">
                    <label>새 비밀번호 확인</label>
                    <input type="password" id="admin-reset-new-password-confirm" class="auth-input" placeholder="새 비밀번호 확인">
                </div>
                <button class="auth-btn" onclick="confirmAdminPasswordChange()">비밀번호 변경</button>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e2e8f0;">
                    <p style="font-size: 12px; color: var(--gray); margin-bottom: 8px;">
                        기존 비밀번호가 기억나지 않으시면 초기화해주세요.
                    </p>
                    <button class="auth-btn" style="background: #ef4444;" onclick="resetAdminPassword()">비밀번호 초기화 (123123)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 관리자 비밀번호 업데이트 (메일 링크 진입 시 표시) -->
    <div id="admin-password-update-modal" class="modal auth-modal" style="display: none;">
        <div class="modal-card" style="max-width: 460px;">
            <div class="modal-header" style="border-bottom: 1px solid #e2e8f0;">
                <h2>새 비밀번호 설정</h2>
                <button class="btn-close-x" onclick="closeAdminPasswordUpdateModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable" style="padding: 20px 24px;">
                <div class="form-group">
                    <label>새 비밀번호</label>
                    <input type="password" id="admin-new-password" class="auth-input" placeholder="새 비밀번호">
                </div>
                <div class="form-group">
                    <label>새 비밀번호 확인</label>
                    <input type="password" id="admin-new-password-confirm" class="auth-input" placeholder="새 비밀번호 확인">
                </div>
                <button class="auth-btn" onclick="confirmAdminPasswordReset()">비밀번호 변경</button>
            </div>
        </div>
    </div>

    <!-- 선생님 비밀번호 변경 -->
    <div id="teacher-password-reset-modal" class="modal auth-modal" style="display: none;">
        <div class="modal-card" style="max-width: 460px;">
            <div class="modal-header" style="border-bottom: 1px solid #e2e8f0;">
                <h2>선생님 비밀번호 변경</h2>
                <button class="btn-close-x" onclick="closeTeacherPasswordResetModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable" style="padding: 20px 24px;">
                <div class="form-group">
                    <label>선생님 선택</label>
                    <select id="reset-teacher-dropdown" class="auth-input">
                        <option value="">선생님을 선택해주세요</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>기존 비밀번호</label>
                    <input type="password" id="reset-teacher-current-password" class="auth-input" placeholder="현재 비밀번호를 입력하세요">
                </div>
                <div class="form-group">
                    <label>새 비밀번호</label>
                    <input type="password" id="reset-teacher-password" class="auth-input" placeholder="새 비밀번호">
                </div>
                <div class="form-group">
                    <label>새 비밀번호 확인</label>
                    <input type="password" id="reset-teacher-password-confirm" class="auth-input" placeholder="새 비밀번호 확인">
                </div>
                <button class="auth-btn" onclick="confirmTeacherPasswordReset()">비밀번호 변경</button>
                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e2e8f0;">
                    <p style="font-size: 12px; color: var(--gray); margin-bottom: 8px;">
                        기존 비밀번호가 기억나지 않으시면 등록된 구글 이메일로 인증번호가 발송됩니다.
                    </p>
                    <div id="reset-teacher-email-display" style="display:none; margin-bottom: 8px; padding: 8px 12px; background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; font-size: 13px; color: #166534; font-weight: 600;">
                        <i class="fas fa-envelope" style="margin-right: 6px;"></i>
                        <span id="reset-teacher-email-text"></span>
                    </div>
                    <div id="reset-teacher-no-email" style="display:none; margin-bottom: 8px; padding: 8px 12px; background: #fff1f2; border: 1px solid #fecaca; border-radius: 8px; font-size: 12px; color: #991b1b;">
                        등록된 구글 이메일이 없습니다. 선생님 등록 시 구글 인증을 진행해주세요.
                    </div>
                    <input type="hidden" id="reset-teacher-email">

                    <!-- Step 1: 인증번호 발송 -->
                    <div id="reset-step1">
                        <button class="auth-btn" style="background: #ef4444;" onclick="sendResetCode()">
                            <i class="fas fa-paper-plane" style="margin-right: 6px;"></i>인증번호 발송
                        </button>
                    </div>

                    <!-- Step 2: 인증번호 입력 및 확인 -->
                    <div id="reset-step2" style="display: none;">
                        <div style="padding: 12px; background: #eef2ff; border: 1px solid #c7d2fe; border-radius: 10px; margin-bottom: 10px;">
                            <p style="font-size: 12px; color: #4338ca; margin: 0 0 8px; font-weight: 600;">
                                <i class="fas fa-check-circle" style="margin-right: 4px;"></i> 인증번호가 발송되었습니다
                            </p>
                            <p style="font-size: 11px; color: #6366f1; margin: 0;">5분 이내에 입력해주세요.</p>
                        </div>
                        <div class="form-group" style="margin-bottom: 10px;">
                            <label style="font-size: 13px; font-weight: 600;">인증번호 6자리</label>
                            <input type="text" id="reset-verify-code" class="auth-input" placeholder="000000" maxlength="6" style="text-align: center; font-size: 24px; letter-spacing: 8px; font-weight: 700;">
                        </div>
                        <button class="auth-btn" style="background: #ef4444;" onclick="verifyAndResetTeacherPassword()">
                            <i class="fas fa-key" style="margin-right: 6px;"></i>확인 및 비밀번호 초기화 (123123)
                        </button>
                        <button class="auth-btn" style="background: #94a3b8; margin-top: 6px;" onclick="sendResetCode()">
                            <i class="fas fa-redo" style="margin-right: 6px;"></i>인증번호 재발송
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 메인 앱 페이지 -->
    <div id="main-app" style="display: none !important;">
        <header class="main-header">
        <div class="header-left">
            <h1 style="font-size: 20px; font-weight: 800; color: var(--primary);">ACADEMY MANAGER</h1>
            <div class="teacher-chip">
                <span class="teacher-chip-label">현재 선생님</span>
                <span id="current-teacher-name" class="teacher-chip-name">미선택</span>
                <button class="teacher-switch-btn" onclick="showTeacherSelectPage()">변경</button>
            </div>
        </div>
        
        <div class="header-center">
            <button class="btn-today" onclick="goToday()">Today</button>
            <div class="date-controller">
                <button class="nav-arrow" id="prev-btn"><i class="fas fa-chevron-left"></i></button>
                <div class="date-display-wrapper">
                    <h2 id="current-display">2026년 1월</h2>
                </div>
                <button class="nav-arrow" id="next-btn"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="jump-date-wrapper">
                <input type="date" id="jump-date-picker" class="jump-date-input" title="날짜 바로 이동">
            </div>
        </div>

        <div class="header-right">
            <button class="btn-header-action" onclick="toggleFeaturePanel()" title="기능 메뉴">
                <i class="fas fa-bars"></i> <span>메뉴</span>
            </button>
            <button class="btn-header-action btn-logout" onclick="signOut()" style="background-color: #ef4444;">
                <i class="fas fa-sign-out-alt"></i> <span>로그아웃</span>
            </button>
        </div>
    </header>

    <div style="display: flex; justify-content: center; margin-top: 20px; gap: 10px;">
        <button class="view-btn active" id="tab-month" onclick="switchView('month')">월간</button>
        <button class="view-btn" id="tab-week" onclick="switchView('week')">주간</button>
    </div>

    <div class="calendar-wrapper">
        <div class="weekday-header">
            <div class="sun">일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div class="sat">토</div>
        </div>
        <div id="calendar-grid" class="calendar-grid"></div>
    </div>

    <div class="drawer-overlay" id="drawer-overlay" onclick="toggleStudentList()"></div>
    <div class="drawer" id="student-drawer">
        <div class="drawer-header">
            <h2 style="margin: 0; font-size: 18px;">학생 목록 <span id="student-list-count" style="font-size:14px; color:var(--primary);">0명</span></h2>
            <button onclick="toggleStudentList()" style="border:none; background:none; font-size: 24px; cursor: pointer;">&times;</button>
        </div>
        <div class="drawer-controls">
            <button class="btn-save-main" onclick="prepareRegister()">+ 학생 등록</button>
            <div class="student-tab-group">
                <button class="student-tab-btn active" id="student-tab-all" onclick="setStudentListTab('all')">전체 학생</button>
                <button class="student-tab-btn" id="student-tab-mine" onclick="setStudentListTab('mine')">내 학생</button>
            </div>
            <div class="student-sort-group">
                <span class="student-sort-label">정렬</span>
                <button class="student-sort-btn active" id="student-sort-default" onclick="setStudentSort('default')">기본</button>
                <button class="student-sort-btn" id="student-sort-grade" onclick="setStudentSort('grade')">학년별</button>
                <button class="student-sort-btn" id="student-sort-school" onclick="setStudentSort('school')">학교별</button>
            </div>
            <input type="text" id="drawer-search-input" class="m-input" placeholder="학생명/학년으로 검색..." style="margin-top: 10px;">
            <div class="checkbox-group" style="justify-content: flex-end; margin-top: 10px;">
                <input type="checkbox" id="show-archived" class="custom-checkbox" onchange="renderDrawerList()">
                <label for="show-archived" class="checkbox-label" style="font-size: 13px !important; color: var(--gray);">퇴원/휴원생만 보기</label>
            </div>
        </div>
        <div id="drawer-content" class="custom-scroll" style="flex: 1; overflow-y: auto; padding: 10px;"></div>
    </div>

    <!-- 기능 메뉴 드로어 -->
    <div class="feature-overlay" id="feature-overlay" onclick="closeFeaturePanel()"></div>
    <div class="feature-drawer" id="feature-drawer">
        <div class="drawer-header" style="justify-content:flex-end;padding:16px 20px;">
            <button onclick="closeFeaturePanel()" style="border:none;background:none;font-size:28px;cursor:pointer;color:#64748b;">&times;</button>
        </div>
        <div class="feature-content custom-scroll">
            <button class="feature-main-btn" id="payment-menu-btn" onclick="openPaymentModal(); closeFeaturePanel();">
                <i class="fas fa-won-sign"></i> 수납 관리
            </button>
            <button class="feature-main-btn" onclick="openModal('schedule-modal'); closeFeaturePanel();">
                <i class="fas fa-calendar-plus"></i> 일정 등록
            </button>
            <button class="feature-main-btn" onclick="openModal('period-delete-modal'); closeFeaturePanel();">
                <i class="fas fa-calendar-times"></i> 일정 삭제
            </button>
            <button class="feature-main-btn" onclick="toggleStudentList(); closeFeaturePanel();">
                <i class="fas fa-users"></i> 학생 관리
            </button>
            <button class="feature-main-btn" onclick="showStudentQRList(); closeFeaturePanel();">
                <i class="fas fa-qrcode"></i> 학생 QR코드
            </button>
            <button class="feature-main-btn" id="qr-attendance-menu-btn" onclick="openQRScanPage(); closeFeaturePanel();">
                <i class="fas fa-camera"></i> QR코드 스캔
            </button>
            <button class="feature-main-btn" id="teacher-menu-btn" onclick="openTeacherModal(); closeFeaturePanel();">
                <i class="fas fa-chalkboard-user"></i> 선생님
            </button>
            <button class="feature-main-btn" onclick="openParentPortal(); closeFeaturePanel();">
                <i class="fas fa-parent"></i> 학부모 포털
            </button>
        </div>
    </div>

    <div id="register-modal" class="modal" style="display: none;">
        <div class="modal-card">
            <div class="modal-header">
                <h2 id="reg-title">학생 등록</h2>
                <button class="btn-close-x" onclick="closeModal('register-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll">
                <input type="hidden" id="edit-id">
                <div class="input-group">
                    <label>등록일</label>
                    <input type="date" id="reg-register-date" class="m-input">
                </div>
                <div class="input-group">
                    <label>기본 정보</label>
                    <div class="form-row">
                        <input type="text" id="reg-name" class="m-input" placeholder="이름">
                    </div>
                    <div class="form-row">
                        <input type="text" id="reg-school" class="m-input" placeholder="학교">
                        <select id="reg-grade" class="m-input">
                            <option value="초1">초1</option><option value="초2">초2</option><option value="초3">초3</option>
                            <option value="초4">초4</option><option value="초5">초5</option><option value="초6">초6</option>
                            <option value="중1">중1</option><option value="중2">중2</option><option value="중3">중3</option>
                            <option value="고1">고1</option><option value="고2">고2</option><option value="고3">고3</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label>학생 연락처</label>
                    <input type="text" id="reg-student-phone" class="m-input" placeholder="010-0000-0000" maxlength="13" oninput="formatPhoneNumber(this)">
                </div>
                <div class="input-group">
                    <label>학부모 연락처</label>
                    <input type="text" id="reg-parent-phone" class="m-input" placeholder="010-0000-0000" maxlength="13" oninput="formatPhoneNumber(this)">
                </div>
                <div class="input-group">
                    <label>기본 수강료 (원)</label>
                    <input type="text" id="reg-default-fee" class="m-input" placeholder="250,000" oninput="formatNumberWithComma(this)">
                </div>
                <div class="input-group">
                    <label>특강비 (원)</label>
                    <input type="text" id="reg-special-fee" class="m-input" placeholder="100,000" oninput="formatNumberWithComma(this)">
                </div>
                <div class="input-group">
                    <label>기본 교재비 (원)</label>
                    <input type="text" id="reg-default-textbook-fee" class="m-input" placeholder="30,000" oninput="formatNumberWithComma(this)">
                </div>
                <div class="input-group">
                    <label>메모</label>
                    <textarea id="reg-memo" class="m-input m-textarea" placeholder="특이사항..."></textarea>
                </div>
            </div>
            <div id="edit-mode-actions">
                <button class="btn-sub-action success" onclick="showStudentAttendanceHistory(document.getElementById('edit-id').value)" id="view-attendance-btn" style="display: none;">
                    <i class="fas fa-clipboard-check"></i> 출석 조회
                </button>
                <button class="btn-sub-action danger" onclick="prepareBulkDelete()" id="bulk-delete-btn" style="display: none;">
                    <i class="fas fa-trash"></i> 일정 삭제
                </button>
                <button class="btn-save-main" id="student-save-btn" onclick="handleStudentSave()">
                    <i class="fas fa-check"></i> 저장
                </button>
            </div>
        </div>
    </div>

    <div id="schedule-modal" class="modal" style="display: none;">
        <div class="modal-card schedule-modal-card">
            <div class="modal-header">
                <h2>일정 생성</h2>
                <button class="btn-close-x" onclick="closeModal('schedule-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="input-group">
                <label>대상 학생 (재원생 목록)</label>
                <div class="student-search-wrapper">
                    <input type="text" id="sch-student-search" class="m-input" placeholder="학생명 또는 학년으로 검색...">
                    <input type="hidden" id="sch-student-select">
                    <div id="sch-student-dropdown" class="student-search-dropdown"></div>
                </div>
                <div id="sch-selected-students" class="schedule-selected-students"></div>
            </div>
            <div class="input-group">
                <label>요일 반복 (미선택 시 날짜 하루만 등록)</label>
                <div class="day-chip-container">
                    <input type="checkbox" id="d1" value="1" class="day-check"><label for="d1">월</label>
                    <input type="checkbox" id="d2" value="2" class="day-check"><label for="d2">화</label>
                    <input type="checkbox" id="d3" value="3" class="day-check"><label for="d3">수</label>
                    <input type="checkbox" id="d4" value="4" class="day-check"><label for="d4">목</label>
                    <input type="checkbox" id="d5" value="5" class="day-check"><label for="d5">금</label>
                    <input type="checkbox" id="d6" value="6" class="day-check"><label for="d6">토</label>
                    <input type="checkbox" id="d0" value="0" class="day-check"><label for="d0">일</label>
                </div>
            </div>
            <div class="input-group">
                <label>기간 및 시간 설정</label>
                <div class="form-row">
                    <input type="date" id="sch-start-date" class="m-input">
                    <div class="input-with-unit">
                        <input type="number" id="sch-weeks" class="m-input" value="4" placeholder="반복">
                        <span class="unit-label">주 반복</span>
                    </div>
                </div>
                <div class="form-row" style="margin-top: 8px;">
                    <input type="time" id="sch-time" class="m-input" value="16:00">
                    <div class="input-with-unit">
                        <input type="number" id="sch-duration-min" class="m-input" value="90">
                        <span class="unit-label">분 수업</span>
                    </div>
                </div>
            </div>
            <div class="schedule-action-buttons">
                <button class="btn-save-main btn-without-holidays" id="schedule-save-without-btn" onclick="generateScheduleWithoutHolidays()">공휴일 제외하고 등록</button>
                <button class="btn-save-main" id="schedule-save-btn" onclick="generateSchedule()">일정 생성하기</button>
            </div>
        </div>
    </div>

    <div id="bulk-delete-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 380px;">
            <div class="modal-header">
                <h2>일정 일괄 삭제</h2>
                <button class="btn-close-x" onclick="closeModal('bulk-delete-modal')"><i class="fas fa-times"></i></button>
            </div>
            <p style="font-size: 13px; color: var(--gray); margin-bottom: 20px; line-height: 1.5;">
                선택한 기간 내의 <b>예정된 수업 일정</b>을 삭제합니다.<br>
                <span style="color: var(--red);">* 이미 작성된 출석/상담 기록은 삭제되지 않습니다.</span>
            </p>
            <input type="hidden" id="bulk-del-sid">
            <div class="input-group">
                <label>삭제 시작 날짜</label>
                <input type="date" id="bulk-del-start" class="m-input">
            </div>
            <div class="input-group">
                <label>삭제 종료 날짜</label>
                <input type="date" id="bulk-del-end" class="m-input">
            </div>
            <button class="btn-save-main" style="background-color: var(--red);" onclick="executeBulkDelete()">일정 삭제하기</button>
        </div>
    </div>

    <div id="period-delete-modal" class="modal" style="display: none;">
        <div class="modal-card period-delete-card" style="max-width: 460px;">
            <div class="modal-header">
                <h2>기간별 일정 삭제</h2>
                <button class="btn-close-x" onclick="closeModal('period-delete-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-content-padding">
                <p style="font-size: 13px; color: var(--gray); margin-bottom: 20px; line-height: 1.5;">
                    지정한 기간 내의 일정을 삭제합니다.<br>
                    <span style="color: var(--red);">* 출석체크가 되지 않은 예정된 일정만 삭제됩니다.</span>
                </p>
                <div class="input-group">
                    <label>삭제 범위</label>
                    <select id="period-del-scope" class="m-input" onchange="togglePeriodDeleteStudent()">
                        <option value="all">기간 내 전체 일정 삭제</option>
                        <option value="student">특정 학생만 삭제</option>
                    </select>
                </div>
                <div class="input-group" id="period-del-student-group" style="display:none;">
                    <label>대상 학생</label>
                    <div class="student-search-wrapper">
                        <input type="text" id="period-del-student-search" class="m-input" placeholder="학생명 또는 학년으로 검색...">
                        <div id="period-del-student-dropdown" class="student-search-dropdown"></div>
                    </div>
                    <div id="period-del-student-selected" class="schedule-selected-students"></div>
                </div>
                <div class="input-group">
                    <label>삭제 시작 날짜</label>
                    <input type="date" id="period-del-start" class="m-input">
                </div>
                <div class="input-group">
                    <label>삭제 종료 날짜</label>
                    <input type="date" id="period-del-end" class="m-input">
                </div>
            </div>
            <div class="modal-footer-actions">
                <button class="btn-delete-action" onclick="executePeriodDelete()">
                    <i class="fas fa-trash-alt"></i> 일정 삭제하기
                </button>
            </div>
        </div>
    </div>

    <div id="day-detail-modal" class="modal" style="display: none;">
        <div class="modal-card day-detail-card">
            <div class="modal-header">
                <h2 id="day-detail-title">날짜</h2>
                <button class="btn-close-x" onclick="closeModal('day-detail-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body custom-scroll">
                <div class="timetable-container">
                    <div class="time-axis" id="time-axis"></div>
                    <div class="time-grid" id="time-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="attendance-modal" class="modal" style="display: none;">
        <div class="modal-card attendance-card">
            <div class="modal-header">
                <h2 id="att-modal-title">수업 관리</h2>
                <button class="btn-close-x" onclick="closeModal('attendance-modal')"><i class="fas fa-times"></i></button>
            </div>
            <input type="hidden" id="att-student-id">
            <input type="hidden" id="att-date">
            <input type="hidden" id="att-original-time">
            <div class="attendance-modal-body custom-scroll">
                <div class="att-info" id="att-info-text"></div>                
                <!-- 현재 출석 상태 표시 -->
                <div class="current-attendance-status">
                    <div class="status-label">현재 상태</div>
                    <div id="current-status-display" class="status-display">미등록</div>
                </div>
                <div class="attendance-options">
                    <button class="att-btn present" onclick="setAttendance('present', { startTime: document.getElementById('att-original-time').value })"><i class="fas fa-check-circle fa-lg"></i>출석</button>
                    <button class="att-btn late" onclick="setAttendance('late', { startTime: document.getElementById('att-original-time').value })"><i class="fas fa-clock fa-lg"></i>지각</button>
                    <button class="att-btn absent" onclick="setAttendance('absent', { startTime: document.getElementById('att-original-time').value })"><i class="fas fa-times-circle fa-lg"></i>결석</button>
                    <button class="att-btn etc" onclick="setAttendance('makeup', { startTime: document.getElementById('att-original-time').value })"><i class="fas fa-exclamation-circle fa-lg"></i>보강</button>
                </div>
                <div class="separator"></div>
                <div class="input-group">
                    <div class="section-label">일정 변경</div>
                    <div class="time-edit-container">
                        <input type="date" id="att-edit-date" class="m-input full-width-date">
                        <div class="time-row">
                            <input type="time" id="att-edit-time" class="m-input">
                            <div class="duration-input-wrapper">
                                <input type="number" id="att-edit-duration" class="m-input duration-input" placeholder="90">
                                <span class="unit-text">분</span>
                            </div>
                            <button class="btn-time-update" onclick="updateClassTime()">변경</button>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <div class="section-label">수업 기록</div>
                    <div class="memo-editor-toolbar">
                        <button type="button" class="color-btn" onclick="applyMemoColor('#ef4444')" style="background:#ef4444;" title="빨강"></button>
                        <button type="button" class="color-btn" onclick="applyMemoColor('#f97316')" style="background:#f97316;" title="주황"></button>
                        <button type="button" class="color-btn" onclick="applyMemoColor('#eab308')" style="background:#eab308;" title="노랑"></button>
                        <button type="button" class="color-btn" onclick="applyMemoColor('#22c55e')" style="background:#22c55e;" title="초록"></button>
                        <button type="button" class="color-btn" onclick="applyMemoColor('#0ea5e9')" style="background:#0ea5e9;" title="파랑"></button>
                        <button type="button" class="color-btn" onclick="applyMemoColor('#7c3aed')" style="background:#7c3aed;" title="보라"></button>
                        <button type="button" class="color-btn" onclick="applyMemoColor('#000000')" style="background:#000000;" title="검정 (기본)"></button>
                    </div>
                    <div id="att-memo" class="m-input m-textarea memo-editor" contenteditable="true" placeholder="진도 내용, 숙제 등"></div>
                    <button class="btn-save-memo" onclick="saveOnlyMemo()">저장</button>
                </div>
                <div class="separator"></div>
            </div>
            <div class="attendance-modal-footer">
                <button class="btn-history" onclick="openHistoryModal()"><i class="fas fa-history"></i> 이번달 기록</button>
                <button class="btn-delete-schedule" onclick="deleteSingleSchedule()"><i class="fas fa-trash"></i> 일정 삭제</button>
            </div>
        </div>
    </div>

    <div id="day-settings-modal" class="modal" style="display: none;">
        <div class="modal-card day-settings-card">
            <div class="modal-header">
                <h2 id="day-settings-title">날짜 설정</h2>
                <button class="btn-close-x" onclick="closeModal('day-settings-modal')"><i class="fas fa-times"></i></button>
            </div>
            <input type="hidden" id="setting-date-str">
            <div class="input-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="is-red-day" class="custom-checkbox">
                    <label for="is-red-day" class="checkbox-label">빨간날(휴원)로 지정</label>
                </div>
            </div>
            <div class="input-group">
                <label>공휴일 이름</label>
                <input type="text" id="day-name" class="m-input" placeholder="예: 개교기념일">
            </div>
            <div class="input-group">
                <label>표시 색상</label>
                <div class="holiday-color-row" id="holiday-color-options">
                    <button type="button" class="color-chip" data-color="#ef4444" onclick="setHolidayColor('#ef4444')" style="background:#ef4444;"></button>
                    <button type="button" class="color-chip" data-color="#f97316" onclick="setHolidayColor('#f97316')" style="background:#f97316;"></button>
                    <button type="button" class="color-chip" data-color="#eab308" onclick="setHolidayColor('#eab308')" style="background:#eab308;"></button>
                    <button type="button" class="color-chip" data-color="#0ea5e9" onclick="setHolidayColor('#0ea5e9')" style="background:#0ea5e9;"></button>
                    <button type="button" class="color-chip" data-color="#10b981" onclick="setHolidayColor('#10b981')" style="background:#10b981;"></button>
                    <button type="button" class="color-chip" data-color="#7c3aed" onclick="setHolidayColor('#7c3aed')" style="background:#7c3aed;"></button>
                </div>
                <input type="hidden" id="holiday-color" value="#ef4444">
            </div>
            <button class="btn-save-main" onclick="saveDaySettings()">저장</button>
        </div>
    </div>

    <div id="history-modal" class="modal" style="display: none;">
        <div class="modal-card history-card">
            <div class="modal-header">
                <div>
                    <h2 id="hist-title">학생 이름</h2>
                    <span id="hist-subtitle" style="font-size: 13px; color: var(--gray);"></span>
                </div>
                <button class="btn-close-x" onclick="closeModal('history-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body custom-scroll">
                <div id="history-timeline" class="timeline-container"></div>
            </div>
        </div>
    </div>

    <div id="payment-modal" class="modal" style="display: none;">
        <div class="modal-card payment-card">
            <div class="modal-header">
                <h2>수납 관리</h2>
                <button class="btn-close-x" onclick="closeModal('payment-modal')"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="payment-controls">
                <button class="nav-arrow" onclick="movePaymentMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                <h3 id="payment-month-title">2026년 1월</h3>
                <button class="nav-arrow" onclick="movePaymentMonth(1)"><i class="fas fa-chevron-right"></i></button>
            </div>

            <div class="payment-filter-container">
                <button class="p-filter-btn active" onclick="setPaymentFilter('all')">전체</button>
                <button class="p-filter-btn" onclick="setPaymentFilter('unpaid')">미납</button>
                <button class="p-filter-btn" onclick="setPaymentFilter('tuition')">수강료</button>
                <button class="p-filter-btn" onclick="setPaymentFilter('textbook')">교재비</button>
                <button class="p-filter-btn" onclick="setPaymentFilter('special')">특강비</button>
            </div>

            <div class="payment-summary-box">
                <div class="summary-item">
                    <span class="s-label">총 수납액</span>
                    <span class="s-value" id="total-collected">0원</span>
                </div>
                <div class="summary-divider"></div>
                <div class="summary-item">
                    <span class="s-label">납부 완료</span>
                    <span class="s-value" id="count-paid" style="color:var(--teal)">0명</span>
                </div>
                <div class="summary-item">
                    <span class="s-label">미납</span>
                    <span class="s-value" id="count-unpaid" style="color:var(--red)">0명</span>
                </div>
            </div>

            <div id="payment-list-container" class="payment-list-container custom-scroll">
                <!-- 학생별 수납 정보가 여기에 동적으로 렌더링됩니다. -->
            </div>
        </div>
    </div>

    <div id="calendar-tooltip" class="calendar-tooltip" style="display: none;"></div>

    <!-- 선생님 관리 모달 -->
    <div id="teacher-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 600px;">
            <div class="modal-header">
                <h2>선생님</h2>
                <button class="btn-close-x" onclick="closeModal('teacher-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll">
                <div id="teacher-list-container" style="padding: 10px;">
                    <!-- 선생님 목록이 여기에 동적으로 렌더링됩니다 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 선생님 상세 정보 모달 -->
    <div id="teacher-detail-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 500px;">
            <div class="modal-header">
                <h2>선생님 상세 정보</h2>
                <button class="btn-close-x" onclick="closeModal('teacher-detail-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll" style="padding: 20px;">
                <div class="input-group">
                    <label>이름</label>
                    <input type="text" id="detail-teacher-name" class="m-input" placeholder="이름을 입력하세요">
                </div>
                <div class="input-group">
                    <label>전화번호</label>
                    <input type="text" id="detail-teacher-phone" class="m-input" placeholder="010-0000-0000" maxlength="13" oninput="formatPhoneNumber(this)">
                </div>
                <div class="input-group">
                    <label>주소</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="detail-teacher-address" class="m-input" placeholder="주소를 검색하세요" readonly style="flex: 1; cursor: pointer;" onclick="searchAddressForDetail()">
                        <button type="button" onclick="searchAddressForDetail()" style="padding: 12px 20px; background: #6366f1; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">검색</button>
                    </div>
                </div>
                <div class="input-group">
                    <label>상세주소 (동/호수)</label>
                    <input type="text" id="detail-teacher-address-detail" class="m-input" placeholder="예: 101동 1202호">
                </div>
                <div class="input-group">
                    <label>메모</label>
                    <textarea id="detail-teacher-memo" class="m-input" rows="5" placeholder="선생님에 대한 메모를 입력하세요" style="resize: vertical; min-height: 100px;"></textarea>
                </div>
                <button class="btn-save-main" onclick="saveTeacherDetail()">저장</button>
            </div>
        </div>
    </div>

    <!-- 선생님 비밀번호 인증 모달 (일반 선생님/직원용) -->
    <div id="teacher-password-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 400px;">
            <div class="modal-header">
                <h2>비밀번호 인증</h2>
                <button class="btn-close-x" onclick="closeModal('teacher-password-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll" style="padding: 20px;">
                <p style="margin-bottom: 20px; color: var(--gray);">선생님의 비밀번호를 입력해주세요.</p>
                <div class="input-group">
                    <label>비밀번호</label>
                    <input type="password" id="teacher-login-password" class="m-input" placeholder="비밀번호">
                </div>
                <button class="btn-save-main" onclick="confirmTeacherPasswordLogin()">인증</button>
            </div>
        </div>
    </div>

    <!-- 관리자 비밀번호 확인 모달 (역할 변경용) -->
    <div id="admin-verify-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 400px;">
            <div class="modal-header">
                <h2>관리자 인증</h2>
                <button class="btn-close-x" onclick="closeAdminVerifyModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll" style="padding: 20px;">
                <div style="padding: 12px; background: #fef3c7; border: 1px solid #fcd34d; border-radius: 10px; margin-bottom: 16px;">
                    <p style="font-size: 13px; color: #92400e; margin: 0; font-weight: 600;">
                        <i class="fas fa-shield-alt" style="margin-right: 6px;"></i>관리자 권한 부여를 위해 인증이 필요합니다
                    </p>
                </div>
                <div class="input-group">
                    <label>관리자 이메일</label>
                    <input type="email" id="admin-verify-email" class="m-input" placeholder="관리자 이메일">
                </div>
                <div class="input-group">
                    <label>관리자 비밀번호</label>
                    <input type="password" id="admin-verify-password" class="m-input" placeholder="관리자 비밀번호">
                </div>
                <input type="hidden" id="admin-verify-teacher-id">
                <input type="hidden" id="admin-verify-new-role">
                <button class="btn-save-main" onclick="confirmAdminVerifyAndChangeRole()">인증 및 권한 변경</button>
            </div>
        </div>
    </div>

    <!-- 관리자 인증 모달 (관리자용) -->
    <div id="admin-teacher-login-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 400px;">
            <div class="modal-header">
                <h2>관리자 인증</h2>
                <button class="btn-close-x" onclick="closeModal('admin-teacher-login-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll" style="padding: 20px;">
                <p style="margin-bottom: 20px; color: var(--gray);">관리자의 이메일과 비밀번호를 입력해주세요.</p>
                <div class="input-group">
                    <label>이메일</label>
                    <input type="email" id="admin-login-email" class="m-input" placeholder="관리자 이메일">
                </div>
                <div class="input-group">
                    <label>비밀번호</label>
                    <input type="password" id="admin-login-password" class="m-input" placeholder="관리자 비밀번호">
                </div>
                <button class="btn-save-main" onclick="confirmAdminTeacherLogin()">인증</button>
            </div>
        </div>
    </div>

    <!-- QR 출석 관리 모달 -->
    <div id="qr-attendance-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 900px; width: 90%;">
            <div class="modal-header">
                <h2>QR 출석 관리</h2>
                <button class="btn-close-x" onclick="closeModal('qr-attendance-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll">
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <button class="btn-save-main" onclick="openQRScanPage()" style="flex: 1;">
                        <i class="fas fa-camera"></i> QR 스캔하기
                    </button>
                    <button class="btn-save-main" onclick="showStudentQRList()" style="flex: 1; background: #10b981;">
                        <i class="fas fa-qrcode"></i> 학생 QR코드 보기
                    </button>
                </div>
                
                <div id="qr-attendance-content">
                    <h3 style="margin-bottom: 15px;">오늘의 출석 현황</h3>
                    <div id="today-attendance-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR 스캔 페이지 (전체 화면) -->
    <div id="qr-scan-page" class="auth-page" style="display: none; background: #1e293b;">
        <div style="width: 100%; max-width: 600px; padding: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: white; margin: 0;">QR 코드 스캔</h2>
                <div style="display: flex; gap: 10px;">
                    <button onclick="switchCamera()" style="background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 16px;">
                        <i class="fas fa-camera-rotate"></i> 카메라 전환
                    </button>
                    <button onclick="closeQRScanPage()" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 16px;">
                        <i class="fas fa-times"></i> 닫기
                    </button>
                </div>
            </div>
            
            <div id="qr-reader" style="width: 100%; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.3);"></div>
            
            <!-- 하단 결과 패널 제거: 상단 토스트만 사용 -->
        </div>
    </div>

    <!-- 학생 QR 코드 목록 모달 -->
    <div id="student-qr-list-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 800px;">
            <div class="modal-header">
                <h2>학생 QR 코드</h2>
                <button class="btn-close-x" onclick="closeModal('student-qr-list-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll">
                <input type="text" id="qr-student-search" class="m-input" placeholder="학생명으로 검색..." onkeyup="filterQRStudentList()" style="margin-bottom: 20px;">
                <div id="student-qr-list"></div>
            </div>
        </div>
    </div>

    <!-- 상태 변경 사유 입력 모달 -->
    <div id="attendance-change-reason-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 480px;">
            <div class="modal-header">
                <h2>출석 상태 변경</h2>
                <button class="btn-close-x" onclick="closeModal('attendance-change-reason-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll">
                <div style="padding: 24px;">
                    <div class="input-group">
                        <label>학생</label>
                        <input type="text" id="change-student-name" class="m-input" readonly style="background: #f8fafc; color: var(--gray); cursor: not-allowed;">
                    </div>
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 12px; color: var(--gray); margin-bottom: 6px;">기존 상태</label>
                            <input type="text" id="change-original-status" class="m-input" readonly style="background: #f8fafc; color: var(--gray); cursor: not-allowed; text-align: center; font-weight: 700; width: 100%;">
                        </div>
                        <div style="padding-bottom: 6px; font-size: 20px; font-weight: 700; color: var(--primary);">→</div>
                        <div style="flex: 1;">
                            <label style="display: block; font-size: 12px; color: var(--primary); margin-bottom: 6px;">변경 상태</label>
                            <input type="text" id="change-new-status" class="m-input" readonly style="background: #eef2ff; color: var(--primary); cursor: not-allowed; text-align: center; font-weight: 700; border: 2px solid var(--primary); width: 100%;">
                        </div>
                    </div>
                    <div class="input-group">
                        <label>변경 사유</label>
                        <textarea id="change-reason-text" class="m-input m-textarea" placeholder="변경 사유를 입력하세요..." maxlength="200" style="resize: none;"></textarea>
                        <div style="font-size: 12px; color: var(--gray); margin-top: 6px; text-align: right;">
                            <span id="change-reason-count">0</span>/200
                        </div>
                    </div>
                </div>
                <input type="hidden" id="change-student-id">
                <input type="hidden" id="change-attendance-date">
            </div>
            <div class="modal-footer-actions">
                <button class="btn-cancel" onclick="closeModal('attendance-change-reason-modal')" style="flex: 1;">
                    <i class="fas fa-times"></i> 취소
                </button>
                <button class="btn-save-main" onclick="confirmAttendanceChange()" style="flex: 1; margin-top: 0;">
                    <i class="fas fa-check"></i> 변경 저장
                </button>
            </div>
        </div>
    </div>

    <!-- 학생별 출석 기록 모달 -->
    <div id="student-attendance-history-modal" class="modal" style="display: none;">
        <div class="modal-card" style="max-width: 750px;">
            <div class="modal-header" style="border-bottom: 2px solid #e2e8f0;">
                <h2 id="attendance-history-title" style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 24px;">📊</span>
                    <span id="attendance-student-name-title">출석 기록</span>
                </h2>
                <button class="btn-close-x" onclick="closeModal('student-attendance-history-modal')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-scrollable custom-scroll" style="padding: 25px;">
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #475569; font-size: 14px;">조회 기간</label>
                    <input type="month" id="attendance-history-month" class="m-input" onchange="loadStudentAttendanceHistory()" style="width: 100%; font-size: 15px; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 10px; transition: all 0.2s;" onfocus="this.style.borderColor='#4f46e5'" onblur="this.style.borderColor='#e2e8f0'">
                </div>
                <div id="attendance-history-content"></div>
            </div>
        </div>
    </div>

    <!-- 학생 재석 확인 알림 모달 -->
    <div id="attendance-check-modal" class="modal" style="display: none; z-index: 10000;">
        <div class="modal-card" style="max-width: 500px; border-radius: 20px; overflow: hidden;">
            <div style="background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); padding: 24px 28px; color: white;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 28px;">🔔</span>
                    <div>
                        <h2 style="margin: 0; font-size: 20px; font-weight: 700;" id="attendance-check-title">수업 시간 확인</h2>
                        <p style="margin: 4px 0 0; font-size: 13px; opacity: 0.85;" id="attendance-check-subtitle"></p>
                    </div>
                </div>
            </div>
            <div class="modal-body-scrollable custom-scroll" style="padding: 20px 24px; max-height: 400px;">
                <p style="color: #475569; font-size: 14px; margin-bottom: 16px;">다음 학생이 아직 자리에 있는지 확인해주세요:</p>
                <div id="attendance-check-list"></div>
            </div>
            <div style="padding: 16px 24px 24px; display: flex; gap: 8px; flex-wrap: wrap;">
                <button onclick="handleAttendanceCheckAll('present')" style="flex:1; padding: 12px 8px; background: #10b981; color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; min-width: 70px;">
                    전체 출석
                </button>
                <button onclick="handleAttendanceCheckAll('late')" style="flex:1; padding: 12px 8px; background: #f59e0b; color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; min-width: 70px;">
                    전체 지각
                </button>
                <button onclick="handleAttendanceCheckAll('absent')" style="flex:1; padding: 12px 8px; background: #ef4444; color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; min-width: 70px;">
                    전체 결석
                </button>
                <button onclick="closeModal('attendance-check-modal')" style="padding: 12px 14px; background: #e2e8f0; color: #475569; border: none; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer;">
                    나중에
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <div class="footer-content">
            <span class="footer-copyright">Copyright</span>
            <span class="footer-divider">|</span>
            <a href="mailto:jjyown@gmail.com" class="footer-email">jjyown@gmail.com</a>
        </div>
    </footer>

    <!-- Supabase와의 연동을 위한 스크립트 -->
   <script src="supabase-config.js"></script>
<script src="database.js"></script>
<script src="auth.js"></script>
<script src="qr-attendance.js"></script>
<script src="qr-token-test.js"></script>
<script src="script.js"></script>
</body>
</html>